<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Alpine.js Playground - body "reflect" function example</title>
    <link
      href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <script
      src="https://unpkg.com/alpinejs@2.0.2/dist/alpine.js"
      defer
    ></script>
  </head>

  <body class="flex flex-row">
    <div class="w-full flex" x-data="reflect()" data-reflect-root>
      <div class="w-1/3 flex flex-col p-4">
        <h2 class="text-lg font-md">Demo</h2>
        <p data-reflect-ignore>
          This paragraph won't be reflected.
        </p>
        <button
          @click="toggleShowClass()"
          class="inline-block w-48 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
        >
          <template x-if="showClass"><span>Hide classes</span></template>
          <template x-if="!showClass"><span>Show classes</span></template>
        </button>
      </div>
      <div class="w-2/3 flex flex-col overflow-scroll">
        <h2>Code</h2>
        <pre><code class="w-full inline-block" x-text="content()"></code></pre>
      </div>
      <script>
        function reflect() {
          const INDENT = "\n  ";
          const ignore = el => {
            return (
              el.dataset.hasOwnProperty("reflectIgnore") || el.tagName === "BR"
            );
          };
          return {
            showClass: false,
            toggleShowClass() {
              this.showClass = !this.showClass;
            },
            content() {
              return this.recurse(
                document.querySelector("[data-reflect-root]") || document.body
              );
            },
            recurse(el) {
              if (ignore(el)) {
                return "";
              }
              if (el.children.length === 0) {
                return this.wrap(el, el.innerHTML);
              }
              return this.wrap(
                el,
                [...el.children]
                  .map(el => this.recurse(el))
                  .filter(Boolean)
                  .join(INDENT)
              );
            },
            wrap(el, content) {
              const tagName = el.tagName.toLowerCase();
              const attributes = [...el.attributes]
                .filter(({ name }) => {
                  if (name === "class" && !this.showClass) {
                    return false;
                  }
                  return true;
                })
                .map(({ name, value }) => `${name}="${value}"`)
                .join(" ");
              return [
                `<${tagName}${attributes ? " " + attributes : ""}>`,
                content,
                `</${tagName}>`
              ].join(INDENT);
            }
          };
        }
      </script>
    </div>
  </body>
</html>
